version: '3.8'
services:
# MongoDB
  mongodb:
      image: mongo:latest
      container_name: mongodb
      restart: always
      environment:
        MONGO_INITDB_ROOT_USERNAME: testuser
        MONGO_INITDB_ROOT_PASSWORD: testpassword
        AUTH: admin
      ports:
        - '27017:27017'
      volumes:
         - 'my_mongodb_data:/data/db'

# Mongo Express
# http://localhost:8081/db/safeshot_vaccination/
  mongo_express:
    image: mongo-express:latest
    container_name: mongo-express
    restart: always
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: testuser
      ME_CONFIG_MONGODB_ADMINPASSWORD: testpassword
      ME_CONFIG_MONGODB_SERVER: mongodb
    ports: 
      - '8081:8081' 
    depends_on:
      - mongodb 

# Node Api Service
  api:
    build: .
    ports: 
      - 8000:8000
  #this is for live change of container server 
    volumes:
      - .:/usr/src/app
    environment:
      PORT: 8000
      DB_USER_NAME: 'testuser'
      DB_PASSWORD :  'testpassword'
      DB_CONNECTION_URL :  'mongodb://mongodb:27017'
      DB_URL_QUERY :  ''
      DB_NAME : 'safeshot_vaccination-doc'
      ACCESS_TOKEN_SECRET :  'Secret'
      REFRESH_TOKEN_SECRET :  'TopSecret'
      TRANSPORT_OWNER :  'prosourav49@gmail.com'
      TRANSPORT_OWNER_SECRET :  'cdlyrpkfhllfzmep'
      CLIENT_APPLICATION_URL :  'http://localhost:3000/auth/verify'
      # this node container will not work if below app is not working
    depends_on:
      - mongodb
      - mongo_express


volumes:
    my_mongodb_data:
      driver: local

      # docker compose https://www.youtube.com/watch?v=vm3YfOHf_Cc&t=1855s (Mafiia codes)